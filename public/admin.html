<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Panel - Valify</title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;700&display=swap" rel="stylesheet">
    <link href="https://cdn.quilljs.com/1.3.6/quill.snow.css" rel="stylesheet">
     
    <link rel="stylesheet" href="style.css">
    
</head>
<body>

    <div class="container" id="login-container">
        <h1>Admin Login</h1>
        <form id="login-form">
            <div class="form-group">
                <label for="email">Email</label>
                <input type="email" id="email" required>
            </div>
            <div class="form-group">
                <label for="password">Password</label>
                <input type="password" id="password" required>
            </div>
            <button type="submit">Login</button>
        </form>
    </div>


    <div class="container" id="admin-header" style="margin-top: 20px;">
        <h1 style="margin: 0; border: none; padding: 0; text-align: left;">
            Selamat Datang, Admin!
        </h1>
        <button id="logout-button" class="logout-btn">Logout</button>
    </div>
    
    <div class="container" id="admin-content" style="margin-top: 20px;">
        <h1>Tulis Artikel Baru</h1>
        <form id="form-artikel">
            <div class="form-group">
                <label for="judul">Judul Artikel</label>
                <input type="text" id="judul" required>
            </div>
            <div class="form-group">
                <label for="deskripsi">Deskripsi Singkat (1-2 Kalimat)</label>
                <textarea id="deskripsi" required></textarea>
            </div>
            <div class="form-group">
                <label>Isi Artikel Lengkap</label>
                <div id="editor-container"></div> 
            </div>
            <div class="form-group">
                <label for="kategori">Kategori</label>
                <select id="kategori" required>
                    <option value="">-- Pilih Kategori --</option>
                    <option value="business">Business</option>
                    <option value="self-development">Self-Development</option>
                </select>
            </div>
            <div class="form-group">
                <label for="urlGambar">URL Gambar</label>
                <input type="text" id="urlGambar" required placeholder="Contoh: https://placehold.co/400x250">
            </div>
            <button type="submit">POSTING ARTIKEL</button>
        </form>
    </div>

    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-firestore.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-auth.js"></script>
    
    <script>
      // Konfigurasi Anda (Tidak berubah)
      const firebaseConfig = {
        apiKey: "AIzaSyCBaMRwg5PP-c2JdX5TGy_FHIN7_gnHC4w",
        authDomain: "valify-website-369e4.firebaseapp.com",
        projectId: "valify-website-369e4",
        storageBucket: "valify-website-369e4.firebasestorage.app",
        messagingSenderId: "491809820627",
        appId: "1:491809820627:web:dd8a14f568732c15946926",
        measurementId: "G-KEBM9P2T30"
      };
      // Inisialisasi Firebase v8
      firebase.initializeApp(firebaseConfig);
      
      // BARU: Inisialisasi service Auth & Firestore
      const auth = firebase.auth();
      const db = firebase.firestore();
    </script>


    <script src="https://cdn.quilljs.com/1.3.6/quill.js"></script>


    <script>
        // --- Referensi ke Elemen HTML ---
        const loginContainer = document.getElementById('login-container');
        const adminHeader = document.getElementById('admin-header');
        const adminContent = document.getElementById('admin-content');
        const loginForm = document.getElementById('login-form');
        const logoutButton = document.getElementById('logout-button');
        const articleForm = document.getElementById('form-artikel');

        // --- Inisialisasi Editor Quill ---
        var toolbarOptions = [
          [{ 'header': [1, 2, 3, false] }],
          ['bold', 'italic', 'underline', 'strike'],        
          [{ 'list': 'ordered'}, { 'list': 'bullet' }],
          ['link'], ['clean']                                         
        ];
        const quill = new Quill('#editor-container', {
            modules: { toolbar: toolbarOptions },
            theme: 'snow' 
        });

        // --- Fungsi untuk Tampilan ---
        function showLoginForm() {
            loginContainer.style.display = 'block';
            adminHeader.style.display = 'none';
            adminContent.style.display = 'none';
        }
        function showAdminContent() {
            loginContainer.style.display = 'none';
            adminHeader.style.display = 'block';
            adminContent.style.display = 'block';
        }

        // --- 1. LOGIKA LOGIN ---
        loginForm.addEventListener('submit', function(e) {
            e.preventDefault();
            const email = document.getElementById('email').value;
            const password = document.getElementById('password').value;
            
            auth.signInWithEmailAndPassword(email, password)
                .then((userCredential) => {
                    // Berhasil login!
                    console.log("Login Berhasil:", userCredential.user);
                    // (Kita tidak perlu lakukan apa-apa di sini, 
                    // 'onAuthStateChanged' akan menangani tampilannya)
                })
                .catch((error) => {
                    console.error("Login Gagal:", error.message);
                    alert("Gagal Login: " + error.message);
                });
        });

        // --- 2. LOGIKA LOGOUT ---
        logoutButton.addEventListener('click', function() {
            auth.signOut().then(() => {
                console.log("Berhasil Logout.");
            }).catch((error) => {
                console.error("Error Logout:", error);
            });
        });

        // --- 3. LOGIKA POSTING ARTIKEL (Sama, tapi pakai 'db' dari atas) ---
        articleForm.addEventListener('submit', function(e) {
            e.preventDefault(); 
            // (Kode posting Anda yang lama, tidak perlu diubah)
            const judul = document.getElementById('judul').value;
            const deskripsi = document.getElementById('deskripsi').value;
            const kategori = document.getElementById('kategori').value;
            const urlGambar = document.getElementById('urlGambar').value;
            const fullContent = quill.root.innerHTML; 

            if (!judul || !deskripsi || !kategori || !urlGambar || !fullContent || fullContent === '<p><br></p>') {
                alert("Harap isi semua field, termasuk Isi Artikel Lengkap.");
                return;
            }

            db.collection("articles").add({
                title: judul, description: deskripsi, category: kategori,
                imageUrl: urlGambar, fullContent: fullContent,
                createdAt: new Date()
            }).then((docRef) => {
                alert("BERHASIL! Artikel Anda sudah diposting.");
                articleForm.reset();
                quill.setText('');
            }).catch((error) => {
                console.error("Error saat posting: ", error);
                alert("GAGAL. Cek console log (F12) untuk error.");
            });
        });

        // --- 4. "PENJAGA PINTU" (Ini bagian terpenting) ---
        // Fungsi ini otomatis berjalan saat halaman dimuat
        // dan setiap kali status login berubah (login/logout)
        auth.onAuthStateChanged(function(user) {
            if (user) {
                // Jika user SUDAH LOGIN...
                console.log("User terdeteksi:", user.email);
                showAdminContent(); // Tampilkan "dapur"
            } else {
                // Jika user TIDAK LOGIN...
                console.log("Tidak ada user yang login.");
                showLoginForm(); // Tampilkan "halaman login"
            }
        });
    </script>

</body>
</html>